const { v4: uuidv4 } = require('uuid');

// Import consistent IDs
const CLASS_IDS = {
  SDIT_1A: '50000000-0000-0000-0000-000000000001',
  SDIT_2C: '50000000-0000-0000-0000-000000000002',
  SDIT_3D: '50000000-0000-0000-0000-000000000003',
  SDIT_4B: '50000000-0000-0000-0000-000000000004',
  SDIT_5A: '50000000-0000-0000-0000-000000000005',
  SDIT_6C: '50000000-0000-0000-0000-000000000006',
  SMP_7M1: '50000000-0000-0000-0000-000000000011',
  SMP_7MD1: '50000000-0000-0000-0000-000000000012',
  SMP_8M1: '50000000-0000-0000-0000-000000000013',
  SMP_8MD1: '50000000-0000-0000-0000-000000000014',
  SMP_9M1: '50000000-0000-0000-0000-000000000015',
  SMP_9MD2: '50000000-0000-0000-0000-000000000016'
};

const USER_IDS = {
  // Teachers
  TEACHER_SDIT_1: '20000000-0000-0000-0000-000000000001',
  TEACHER_SDIT_2: '20000000-0000-0000-0000-000000000002',
  TEACHER_SDIT_3: '20000000-0000-0000-0000-000000000003',
  TEACHER_SDIT_4: '20000000-0000-0000-0000-000000000004',
  TEACHER_SMP_1: '20000000-0000-0000-0000-000000000011',
  TEACHER_SMP_2: '20000000-0000-0000-0000-000000000012',
  TEACHER_SMP_3: '20000000-0000-0000-0000-000000000013',
  TEACHER_SMP_4: '20000000-0000-0000-0000-000000000014',
  
  // SDIT Students
  STUDENT_SDIT_1A_1: '30000000-0000-0000-0000-000000000001',
  STUDENT_SDIT_1A_2: '30000000-0000-0000-0000-000000000002',
  STUDENT_SDIT_1A_3: '30000000-0000-0000-0000-000000000003',
  STUDENT_SDIT_1A_4: '30000000-0000-0000-0000-000000000004',
  STUDENT_SDIT_1A_5: '30000000-0000-0000-0000-000000000005',
  
  STUDENT_SDIT_2C_1: '30000000-0000-0000-0000-000000000011',
  STUDENT_SDIT_2C_2: '30000000-0000-0000-0000-000000000012',
  STUDENT_SDIT_2C_3: '30000000-0000-0000-0000-000000000013',
  STUDENT_SDIT_2C_4: '30000000-0000-0000-0000-000000000014',
  STUDENT_SDIT_2C_5: '30000000-0000-0000-0000-000000000015',
  
  STUDENT_SDIT_3D_1: '30000000-0000-0000-0000-000000000021',
  STUDENT_SDIT_3D_2: '30000000-0000-0000-0000-000000000022',
  STUDENT_SDIT_3D_3: '30000000-0000-0000-0000-000000000023',
  STUDENT_SDIT_3D_4: '30000000-0000-0000-0000-000000000024',
  STUDENT_SDIT_3D_5: '30000000-0000-0000-0000-000000000025',
  
  STUDENT_SDIT_4B_1: '30000000-0000-0000-0000-000000000031',
  STUDENT_SDIT_4B_2: '30000000-0000-0000-0000-000000000032',
  STUDENT_SDIT_4B_3: '30000000-0000-0000-0000-000000000033',
  STUDENT_SDIT_4B_4: '30000000-0000-0000-0000-000000000034',
  STUDENT_SDIT_4B_5: '30000000-0000-0000-0000-000000000035',
  
  STUDENT_SDIT_5A_1: '30000000-0000-0000-0000-000000000041',
  STUDENT_SDIT_5A_2: '30000000-0000-0000-0000-000000000042',
  STUDENT_SDIT_5A_3: '30000000-0000-0000-0000-000000000043',
  STUDENT_SDIT_5A_4: '30000000-0000-0000-0000-000000000044',
  STUDENT_SDIT_5A_5: '30000000-0000-0000-0000-000000000045',
  
  STUDENT_SDIT_6C_1: '30000000-0000-0000-0000-000000000051',
  STUDENT_SDIT_6C_2: '30000000-0000-0000-0000-000000000052',
  STUDENT_SDIT_6C_3: '30000000-0000-0000-0000-000000000053',
  STUDENT_SDIT_6C_4: '30000000-0000-0000-0000-000000000054',
  STUDENT_SDIT_6C_5: '30000000-0000-0000-0000-000000000055',
  
  // SMP Students
  STUDENT_SMP_7M1_1: '30000000-0000-0000-0000-000000000101',
  STUDENT_SMP_7M1_2: '30000000-0000-0000-0000-000000000102',
  STUDENT_SMP_7M1_3: '30000000-0000-0000-0000-000000000103',
  STUDENT_SMP_7M1_4: '30000000-0000-0000-0000-000000000104',
  STUDENT_SMP_7M1_5: '30000000-0000-0000-0000-000000000105',
  
  STUDENT_SMP_7MD1_1: '30000000-0000-0000-0000-000000000111',
  STUDENT_SMP_7MD1_2: '30000000-0000-0000-0000-000000000112',
  STUDENT_SMP_7MD1_3: '30000000-0000-0000-0000-000000000113',
  STUDENT_SMP_7MD1_4: '30000000-0000-0000-0000-000000000114',
  STUDENT_SMP_7MD1_5: '30000000-0000-0000-0000-000000000115',
  
  STUDENT_SMP_8M1_1: '30000000-0000-0000-0000-000000000121',
  STUDENT_SMP_8M1_2: '30000000-0000-0000-0000-000000000122',
  STUDENT_SMP_8M1_3: '30000000-0000-0000-0000-000000000123',
  STUDENT_SMP_8M1_4: '30000000-0000-0000-0000-000000000124',
  STUDENT_SMP_8M1_5: '30000000-0000-0000-0000-000000000125',
  
  STUDENT_SMP_8MD1_1: '30000000-0000-0000-0000-000000000131',
  STUDENT_SMP_8MD1_2: '30000000-0000-0000-0000-000000000132',
  STUDENT_SMP_8MD1_3: '30000000-0000-0000-0000-000000000133',
  STUDENT_SMP_8MD1_4: '30000000-0000-0000-0000-000000000134',
  STUDENT_SMP_8MD1_5: '30000000-0000-0000-0000-000000000135',
  
  STUDENT_SMP_9M1_1: '30000000-0000-0000-0000-000000000141',
  STUDENT_SMP_9M1_2: '30000000-0000-0000-0000-000000000142',
  STUDENT_SMP_9M1_3: '30000000-0000-0000-0000-000000000143',
  STUDENT_SMP_9M1_4: '30000000-0000-0000-0000-000000000144',
  STUDENT_SMP_9M1_5: '30000000-0000-0000-0000-000000000145',
  
  STUDENT_SMP_9MD2_1: '30000000-0000-0000-0000-000000000151',
  STUDENT_SMP_9MD2_2: '30000000-0000-0000-0000-000000000152',
  STUDENT_SMP_9MD2_3: '30000000-0000-0000-0000-000000000153',
  STUDENT_SMP_9MD2_4: '30000000-0000-0000-0000-000000000154',
  STUDENT_SMP_9MD2_5: '30000000-0000-0000-0000-000000000155'
};

/**
 * @param { import("knex").Knex } knex
 * @returns { Promise<void> } 
 */
exports.seed = async function(knex) {
  // Deletes ALL existing entries
  await knex('user_classes').del();
  
  const userClasses = [];
  
  // Teacher-Class assignments
  const teacherAssignments = [
    // SDIT Teachers
    { teacherId: USER_IDS.TEACHER_SDIT_1, classIds: [CLASS_IDS.SDIT_1A, CLASS_IDS.SDIT_5A] },
    { teacherId: USER_IDS.TEACHER_SDIT_2, classIds: [CLASS_IDS.SDIT_2C, CLASS_IDS.SDIT_6C] },
    { teacherId: USER_IDS.TEACHER_SDIT_3, classIds: [CLASS_IDS.SDIT_3D, CLASS_IDS.SDIT_4B] },
    { teacherId: USER_IDS.TEACHER_SDIT_4, classIds: [CLASS_IDS.SDIT_4B, CLASS_IDS.SDIT_1A] },
    
    // SMP Teachers
    { teacherId: USER_IDS.TEACHER_SMP_1, classIds: [CLASS_IDS.SMP_7M1, CLASS_IDS.SMP_9M1] },
    { teacherId: USER_IDS.TEACHER_SMP_2, classIds: [CLASS_IDS.SMP_7MD1, CLASS_IDS.SMP_9MD2] },
    { teacherId: USER_IDS.TEACHER_SMP_3, classIds: [CLASS_IDS.SMP_8M1, CLASS_IDS.SMP_7M1] },
    { teacherId: USER_IDS.TEACHER_SMP_4, classIds: [CLASS_IDS.SMP_8MD1, CLASS_IDS.SMP_7MD1] }
  ];
  
  teacherAssignments.forEach(assignment => {
    assignment.classIds.forEach(classId => {
      userClasses.push({
        id: uuidv4(),
        user_id: assignment.teacherId,
        class_id: classId,
        role_in_class: 'teacher',
        is_active: true,
        created_at: new Date(),
        updated_at: new Date()
      });
    });
  });
  
  // Student-Class assignments
  const studentClassMappings = [
    // SDIT Classes
    { classId: CLASS_IDS.SDIT_1A, studentIds: [USER_IDS.STUDENT_SDIT_1A_1, USER_IDS.STUDENT_SDIT_1A_2, USER_IDS.STUDENT_SDIT_1A_3, USER_IDS.STUDENT_SDIT_1A_4, USER_IDS.STUDENT_SDIT_1A_5] },
    { classId: CLASS_IDS.SDIT_2C, studentIds: [USER_IDS.STUDENT_SDIT_2C_1, USER_IDS.STUDENT_SDIT_2C_2, USER_IDS.STUDENT_SDIT_2C_3, USER_IDS.STUDENT_SDIT_2C_4, USER_IDS.STUDENT_SDIT_2C_5] },
    { classId: CLASS_IDS.SDIT_3D, studentIds: [USER_IDS.STUDENT_SDIT_3D_1, USER_IDS.STUDENT_SDIT_3D_2, USER_IDS.STUDENT_SDIT_3D_3, USER_IDS.STUDENT_SDIT_3D_4, USER_IDS.STUDENT_SDIT_3D_5] },
    { classId: CLASS_IDS.SDIT_4B, studentIds: [USER_IDS.STUDENT_SDIT_4B_1, USER_IDS.STUDENT_SDIT_4B_2, USER_IDS.STUDENT_SDIT_4B_3, USER_IDS.STUDENT_SDIT_4B_4, USER_IDS.STUDENT_SDIT_4B_5] },
    { classId: CLASS_IDS.SDIT_5A, studentIds: [USER_IDS.STUDENT_SDIT_5A_1, USER_IDS.STUDENT_SDIT_5A_2, USER_IDS.STUDENT_SDIT_5A_3, USER_IDS.STUDENT_SDIT_5A_4, USER_IDS.STUDENT_SDIT_5A_5] },
    { classId: CLASS_IDS.SDIT_6C, studentIds: [USER_IDS.STUDENT_SDIT_6C_1, USER_IDS.STUDENT_SDIT_6C_2, USER_IDS.STUDENT_SDIT_6C_3, USER_IDS.STUDENT_SDIT_6C_4, USER_IDS.STUDENT_SDIT_6C_5] },
    
    // SMP Classes
    { classId: CLASS_IDS.SMP_7M1, studentIds: [USER_IDS.STUDENT_SMP_7M1_1, USER_IDS.STUDENT_SMP_7M1_2, USER_IDS.STUDENT_SMP_7M1_3, USER_IDS.STUDENT_SMP_7M1_4, USER_IDS.STUDENT_SMP_7M1_5] },
    { classId: CLASS_IDS.SMP_7MD1, studentIds: [USER_IDS.STUDENT_SMP_7MD1_1, USER_IDS.STUDENT_SMP_7MD1_2, USER_IDS.STUDENT_SMP_7MD1_3, USER_IDS.STUDENT_SMP_7MD1_4, USER_IDS.STUDENT_SMP_7MD1_5] },
    { classId: CLASS_IDS.SMP_8M1, studentIds: [USER_IDS.STUDENT_SMP_8M1_1, USER_IDS.STUDENT_SMP_8M1_2, USER_IDS.STUDENT_SMP_8M1_3, USER_IDS.STUDENT_SMP_8M1_4, USER_IDS.STUDENT_SMP_8M1_5] },
    { classId: CLASS_IDS.SMP_8MD1, studentIds: [USER_IDS.STUDENT_SMP_8MD1_1, USER_IDS.STUDENT_SMP_8MD1_2, USER_IDS.STUDENT_SMP_8MD1_3, USER_IDS.STUDENT_SMP_8MD1_4, USER_IDS.STUDENT_SMP_8MD1_5] },
    { classId: CLASS_IDS.SMP_9M1, studentIds: [USER_IDS.STUDENT_SMP_9M1_1, USER_IDS.STUDENT_SMP_9M1_2, USER_IDS.STUDENT_SMP_9M1_3, USER_IDS.STUDENT_SMP_9M1_4, USER_IDS.STUDENT_SMP_9M1_5] },
    { classId: CLASS_IDS.SMP_9MD2, studentIds: [USER_IDS.STUDENT_SMP_9MD2_1, USER_IDS.STUDENT_SMP_9MD2_2, USER_IDS.STUDENT_SMP_9MD2_3, USER_IDS.STUDENT_SMP_9MD2_4, USER_IDS.STUDENT_SMP_9MD2_5] }
  ];
  
  studentClassMappings.forEach(mapping => {
    mapping.studentIds.forEach(studentId => {
      userClasses.push({
        id: uuidv4(),
        user_id: studentId,
        class_id: mapping.classId,
        role_in_class: 'student',
        is_active: true,
        created_at: new Date(),
        updated_at: new Date()
      });
    });
  });
  
  await knex('user_classes').insert(userClasses);

  console.log('âœ… User-Class relationships seeded successfully');
  console.log(`   - Total relationships: ${userClasses.length}`);
  console.log(`   - Teacher assignments: ${teacherAssignments.length * 2} (avg 2 classes per teacher)`);
  console.log(`   - Student enrollments: ${studentClassMappings.length * 5} (5 students per class)`);
};
